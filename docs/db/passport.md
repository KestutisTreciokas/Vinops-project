# Паспорт БД — PostgreSQL 17 (managed) — текущий срез

**Дата/время:** ${TS}

## 1) Доступ и идентификация
- **FQDN (prod):** `418a052549dc7dac1163fd68.twc1.net`  
- **Порт:** `5432`  
- **Клиентский режим:** **`sslmode=verify-full` обязателен**  
- **Dev/локальные DSN:** хранятся только в зашумлённом виде в `evidence/S1/db/db_url.masked.txt` (без секретов).

**Как верифицировать имя:** клиент обязан указывать `-h 418a052549dc7dac1163fd68.twc1.net` и `-sslmode=verify-full`. При несоответствии имени соединение должно падать.

## 2) TLS и сертификат
- **CN:** `418a052549dc7dac1163fd68.twc1.net`  
- **SAN:** `DNS:418a052549dc7dac1163fd68.twc1.net`  
- **Issuer:** `managed-service.timeweb.cloud`  
- **Срок действия (UTC):** `2025-09-22 → 2026-09-22`  
- **SHA-256:** `5E:24:B3:D8:2C:06:98:02:BC:45:77:94:6D:FE:BC:EE:33:D8:19:45:83:41:8E:B4:6E:98:7D:53:05:F6:2F:E0`

**Инвариант:** клиенты используют **verify-full** и CA провайдера (путь к CA фиксируется во внутренней конфигурации, без коммита секретов).

## 3) Расширения (обязательный набор)
Требуются и **подтверждены установленные**:
- `pg_stat_statements` — **OK**
- `pg_trgm` — **OK**
- `pgcrypto` — **OK**
- `citext` — **OK**

Источник: evidence `evidence/S1/db/extensions_status.txt`.

## 4) Роли и права
- **Роль `app_ro`:** только **SELECT** на схемы чтения Core.  
- **Роль `etl_rw`:** `SELECT/INSERT/UPDATE` на Core; в `stg.*` — полный DML.  
- **Владение объектами Core:** `db_admin`.  
- **Политика read-only (информативно):** уровень GUC/роль; факт проверяется на окружении (внутренними отчётами), публикация SQL/грантов — запрещена.

## 5) Метаданные и верификация
- **Версия сервера:** PostgreSQL 17 (по паспорту сервиса).  
- **Runtime-пруф TLS/RO:** выполняется внутренне (например, `select ssl_is_used();`, проверка `default_transaction_read_only`), выводы не публикуются.

## 6) Резюме
- **FQDN/CN/SAN/Issuer/срок/sha256** — зафиксированы.  
- **`sslmode=verify-full`** — **обязателен**.  
- **Обязательные расширения** — подтверждены.  
- **Роли** — описаны (без публикации чувствительных SQL/грантов).

> Все чувствительные данные (логины/пароли/полные DSN/CA-файлы) отсутствуют в этом документе и evidence.
