# CONFLICT_POLICY — PR #84 (каноники и правила разрешения конфликтов)

- Generated: Europe/Warsaw
- Scope: формализация «чья версия» по зонам и путям при консолидации PR #84.
- Приоритет SEO: **canonical + hreflang + JSON-LD** имеют приоритет над UI-изменениями.

## Таблица зон и правил

| Зона        | Паттерны путей                                                                 | Канон        | Правило/заметки                                                                                                  |
|-------------|---------------------------------------------------------------------------------|--------------|-------------------------------------------------------------------------------------------------------------------|
| **SSOT/Policy** | `docs/ssot/**`, `docs/policy/**`, **`openapi.yaml`**                            | **main**     | Источники истины и контракты. Из PR принимаем только если **не противоречат** SSOT v20250927 и API v1.           |
| **Code (App)**  | `frontend/src/**`, `frontend/app/**`, `src/**`, `app/**`                        | **PR**       | Берём из PR **при соблюдении SEO-инвариантов** (canonical/hreflang/JSON-LD). Конфликт в `<head>` → канон SEO.    |
| **SEO/Public**  | `public/**` (иконки/шрифты/статик)                                            | **main**     | Жёстко: **self-hosted** шрифты, без Google Fonts. Любые отклонения — отклоняются.                                |
| **Infra/CI/CD** | `.github/**`, `docker-compose*`, `infra/**`, `nginx/**`, `caddy/**`, `scripts/**`| **main**     | Инфраструктурные политики/пайплайны — стабильность приоритете; изменения из PR — только по отдельному решению.   |
| **DB/Migrations** | `db/migrations/**`, `db/**`                                                   | **PR**       | Принимаем, если согласуется с целевой схемой PG17 и **не ломает** API v1 (EMC-подход: expand→migrate).            |
| **Contracts**   | `contracts/**`, `contracts/openapi.yaml`                                       | **main**     | Контракт API v1 — канон main; доработки — отдельным согласованным PR.                                            |
| **Docs (merge)**| `docs/merges/**`                                                               | **PR**       | Техническая документация процесса слияния (CHANGESET/PLAN/REPORT/политики).                                      |

## Кейсы (примеры)

1. **Кейс SEO `<head>` vs UI**  
   Конфликт в `frontend/src/app/[lang]/vin/[vin]/page.tsx` затрагивает `<head>`.  
   **Решение:** берём вариант, сохраняющий canonical/hreflang/JSON-LD (канон SEO), UI-часть переносим коммитом-следом.

2. **Кейс public/**  
   PR добавляет подключение стороннего CDN-шрифта и новые иконки в `public/`.  
   **Решение:** **main** (self-hosted инвариант), внешние шрифты — запрещены.

3. **Кейс OpenAPI**  
   В `contracts/openapi.yaml` PR меняет схему типов.  
   **Решение:** **main** (контракт v1); изменения выносятся в отдельный PR или в `/api/v2`.

4. **Кейс Infra**  
   PR модифицирует `.github/workflows/*` и `caddy/Caddyfile`.  
   **Решение:** **main** (инфра — стабильность). Изменения — только через согласованное решение и отдельный PR.

5. **Кейс DB миграции**  
   В `db/migrations/xxxx.sql` — новая колонка для отчётности.  
   **Решение:** **PR** при EMC и отсутствии breaking для API v1.

## Tie-breaker
При неоднозначности — **manual-merge** с фиксацией в `MERGE_REPORT.md` (что и почему взяли).
